.jshint_template: &jshint_definition
  image: $APIGEE_FMK_NODE_IMAGE_NAME  
  script:
    - echo "LAST_EXECUTED_STAGE_NAME=$CI_JOB_STAGE" >> build.env
    - echo "LAST_EXECUTED_STAGE_URL=$CI_JOB_URL" >> build.env
    - |
      if [ -d "apiproxy/resources/jsc" ]; then
        cd apiproxy/resources/jsc
        jshint *.js | tee policyReportJSHint.json
        JSHINT_EXIT_CODE=$?
        mv policyReportJSHint.json ../../../
        cd ../../../test/unit
        jshint *.js | tee unitTestReportJSHint.json
        mv unitTestReportJSHint.json ../
        EXIT_CODE=$((EXIT_CODE + JSHINT_EXIT_CODE))
      elif [ -d "edge/apiproxy/resources/jsc" ]; then
        cd edge/apiproxy/resources/jsc
        jshint *.js | tee policyReportJSHint.json
        JSHINT_EXIT_CODE=$?
        mv policyReportJSHint.json ../../../
        cd ../../../test/unit
        jshint *.js | tee unitTestReportJSHint.json
        mv unitTestReportJSHint.json ../..
        EXIT_CODE=$((EXIT_CODE + JSHINT_EXIT_CODE))
      else
        echo "Directory apiproxy/resources/jsc or edge/apiproxy/resources/jsc does not exist."
        EXIT_CODE=0
      fi
    - exit $EXIT_CODE